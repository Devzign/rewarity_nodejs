{
  "openapi": "3.0.3",
  "info": {
    "title": "Rewarity API",
    "version": "1.0.0",
    "description": "OpenAPI spec for Rewarity backend (OTP-only auth). Admin users use a fixed OTP of 555444 by default (overridable via ADMIN_OTP env)."
  },
  "servers": [ { "url": "/" } ],
  "paths": {
    "/": { "get": { "summary": "Health check", "responses": { "200": { "description": "OK" } } } },
    "/api/auth/register": { "post": { "summary": "Register user (OTP)", "requestBody": { "required": true, "content": { "application/json": { "schema": { "$ref": "#/components/schemas/RegisterRequest" } } } }, "responses": { "201": { "description": "User created" }, "400": { "$ref": "#/components/responses/BadRequest" }, "409": { "$ref": "#/components/responses/Conflict" } } } },
    "/api/auth/login": { "post": { "summary": "OTP login (send/verify)", "description": "Two-step endpoint. Send OTP with just mobile; verify by including code. If the user is of type Admin, the OTP is fixed (555444) and not consumed.", "requestBody": { "required": true, "content": { "application/json": { "schema": { "oneOf": [ { "$ref": "#/components/schemas/LoginSendOtpRequest" }, { "$ref": "#/components/schemas/LoginVerifyOtpRequest" } ] }, "examples": { "SendOtp": { "summary": "Send OTP", "value": { "mobile": "9999999999" } }, "VerifyAdmin": { "summary": "Admin verify", "value": { "mobile": "9999999999", "code": "555444" } } } } } }, "responses": { "200": { "description": "OTP sent or login success", "content": { "application/json": { "schema": { "oneOf": [ { "$ref": "#/components/schemas/OtpSentResponse" }, { "$ref": "#/components/schemas/LoginSuccessResponse" } ] } } } }, "400": { "$ref": "#/components/responses/BadRequest" }, "403": { "$ref": "#/components/responses/Forbidden" }, "404": { "$ref": "#/components/responses/NotFound" } } } },
    "/api/auth/request-otp": { "post": { "summary": "Request OTP", "description": "Issues an OTP for the given purpose. Admin users always receive the fixed code (555444).", "requestBody": { "required": true, "content": { "application/json": { "schema": { "$ref": "#/components/schemas/RequestOtp" }, "examples": { "Admin": { "value": { "mobile": "9999999999", "purpose": "login" } } } } } }, "responses": { "200": { "description": "OTP issued", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/OtpSentResponse" } } } }, "404": { "$ref": "#/components/responses/NotFound" } } } },
    "/api/auth/verify-otp": { "post": { "summary": "Verify OTP", "description": "Verifies OTP and returns JWT. For Admin users, code 555444 is accepted and not consumed.", "requestBody": { "required": true, "content": { "application/json": { "schema": { "$ref": "#/components/schemas/VerifyOtp" }, "examples": { "Admin": { "value": { "mobile": "9999999999", "code": "555444" } } } } } }, "responses": { "200": { "description": "Login success", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/LoginSuccessResponse" } } } }, "400": { "$ref": "#/components/responses/BadRequest" }, "404": { "$ref": "#/components/responses/NotFound" } } } },
    "/api/users/create-type": { "post": { "summary": "Create a user type", "requestBody": { "required": true, "content": { "application/json": { "schema": { "$ref": "#/components/schemas/UserTypeCreate" } } } }, "responses": { "201": { "description": "Created" }, "500": { "$ref": "#/components/responses/ServerError" } } } },
    "/api/users/create-user": { "post": { "summary": "Create user", "requestBody": { "required": true, "content": { "application/json": { "schema": { "$ref": "#/components/schemas/CreateUserRequest" } } } }, "responses": { "201": { "description": "User created" }, "400": { "$ref": "#/components/responses/BadRequest" }, "500": { "$ref": "#/components/responses/ServerError" } } } },
    "/api/openapi.json": { "get": { "summary": "Serve OpenAPI JSON", "responses": { "200": { "description": "Spec JSON" } } } }
    ,
    "/api/dev/otps": {
      "get": {
        "summary": "[DEV] List recent OTPs",
        "parameters": [
          { "name": "mobile", "in": "query", "required": false, "schema": { "type": "string" } },
          { "name": "limit", "in": "query", "required": false, "schema": { "type": "integer", "minimum": 1, "maximum": 20 }, "example": 5 },
          { "name": "x-dev-key", "in": "header", "required": false, "schema": { "type": "string" }, "description": "Required in production: matches DEV_ADMIN_KEY" }
        ],
        "responses": {
          "200": { "description": "OK" },
          "403": { "description": "Forbidden" }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "RegisterRequest": { "type": "object", "required": ["userName", "primaryMobile", "typeName"], "properties": { "userName": { "type": "string" }, "primaryMobile": { "type": "string" }, "typeName": { "type": "string" }, "email": { "type": "string" }, "address1": { "type": "string" }, "address2": { "type": "string" }, "cityName": { "type": "string" } } },
      "LoginSendOtpRequest": { "type": "object", "required": ["mobile"], "properties": { "mobile": { "type": "string" } } },
      "LoginVerifyOtpRequest": { "type": "object", "required": ["mobile", "code"], "properties": { "mobile": { "type": "string" }, "code": { "type": "string" } } },
      "RequestOtp": { "type": "object", "required": ["mobile", "purpose"], "properties": { "mobile": { "type": "string" }, "purpose": { "type": "string", "enum": ["login", "register"] } } },
      "VerifyOtp": { "type": "object", "required": ["mobile", "code"], "properties": { "mobile": { "type": "string" }, "code": { "type": "string" } } },
      "UserTypeCreate": { "type": "object", "required": ["name"], "properties": { "name": { "type": "string" }, "description": { "type": "string" } } },
      "CreateUserRequest": { "type": "object", "required": ["userName", "primaryMobile", "typeName"], "properties": { "userName": { "type": "string" }, "primaryMobile": { "type": "string" }, "typeName": { "type": "string" }, "email": { "type": "string" }, "address1": { "type": "string" }, "address2": { "type": "string" }, "cityName": { "type": "string" } } },
      "OtpSentResponse": { "type": "object", "properties": { "message": { "type": "string", "example": "OTP sent" }, "mobile": { "type": "string", "example": "xxxxxx9999" }, "debugOtp": { "type": "object", "nullable": true, "properties": { "code": { "type": "string", "example": "555444" }, "expiresAt": { "type": "string", "format": "date-time" } }, "description": "Included only in non-production." } } },
      "LoginSuccessResponse": { "type": "object", "properties": { "message": { "type": "string", "example": "Login successful" }, "token": { "type": "string" }, "user": { "type": "object", "properties": { "id": { "type": "string" }, "userName": { "type": "string", "example": "Admin" }, "email": { "type": "string", "example": "admin@rewarity.com" }, "uniqueCode": { "type": "string", "example": "ADMIN-001" } } } } }
    },
    "responses": {
      "BadRequest": { "description": "Bad Request" },
      "Conflict": { "description": "Conflict" },
      "Forbidden": { "description": "Forbidden" },
      "NotFound": { "description": "Not Found" },
      "ServerError": { "description": "Server Error" },
      "OtpIssued": { "description": "OTP issued" },
      "LoginSuccess": { "description": "Login success" }
    },
    "securitySchemes": { "BearerAuth": { "type": "http", "scheme": "bearer", "bearerFormat": "JWT" } }
  }
}
